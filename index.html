<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>PREP Pipeline: EEG-Clean-Tools by VisLab</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">PREP Pipeline: EEG-Clean-Tools</h1>
      <h2 class="project-tagline">Contains tools for EEG standardized preprocessing</h2>
      <a href="https://github.com/VisLab/EEG-Clean-Tools" class="btn">View on GitHub</a>
      <a href="https://github.com/VisLab/EEG-Clean-Tools/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/VisLab/EEG-Clean-Tools/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h1>
<a id="introduction-to-the-prep-pipeline" class="anchor" href="#introduction-to-the-prep-pipeline" aria-hidden="true"><span class="octicon octicon-link"></span></a>Introduction to the PREP pipeline</h1>

<p>The PREP pipeline is a standardized early-stage EEG processing pipeline that focuses on the identification of bad channels and the calculation of a robust average reference. PREP also has an extensive reporting facility. It is designed to be run in a completely automated way. The major sections of this document are:</p>

<ul>
<li>Introduction (requirements, citing, installation)</li>
<li>Algorithm (steps, meaning of parameters for each step)</li>
<li>Running as an EEGLAB plug-in</li>
<li>Running as a script</li>
</ul>

<h3>
<a id="requirements" class="anchor" href="#requirements" aria-hidden="true"><span class="octicon octicon-link"></span></a>Requirements</h3>

<p>The PREP pipeline relies on the MATLAB Signal Processing toolbox and EEGLAB, a freely-available MATLAB toolbox for processing EEG. EEG is available from  <a href="http://scn.ucsd.edu/eeglab">http://scn.ucsd.edu/eeglab</a>. PREP assumes that the EEG data is provided as an EEGLAB EEG structure and that channel locations are provided in the EEG.chanlocs structure.</p>

<h3>
<a id="citing-the-prep-pipeline" class="anchor" href="#citing-the-prep-pipeline" aria-hidden="true"><span class="octicon octicon-link"></span></a>Citing the PREP pipeline</h3>

<p>The PREP pipeline is freely available under the GUN General Public License. 
Please cite the following publication if using:  </p>

<blockquote>
<p>Bigdely-Shamlo N, Mullen T, Kothe C, Su K-M and Robbins KA (2015)<br>
The PREP pipeline: standardized preprocessing for large-scale EEG analysis<br>
Front. Neuroinform. 9:16. doi: 10.3389/fninf.2015.00016  </p>
</blockquote>

<h3>
<a id="installation" class="anchor" href="#installation" aria-hidden="true"><span class="octicon octicon-link"></span></a>Installation</h3>

<p>The PREP pipeline can be run in two ways --- as a standalone toolbox or as an EEGLAB plugin. To run in standalone mode, simply download the PREP code, found the the EEG-Clean-Tools</p>

<h1>
<a id="prep-as-an-eeglab-plugin" class="anchor" href="#prep-as-an-eeglab-plugin" aria-hidden="true"><span class="octicon octicon-link"></span></a>PREP as an EEGLAB plugin</h1>

<p>You can install PREP as an EEGLAB plugin by unzipping the PREPPipeline directory into the plugins directory of
your EEGLAB installation. </p>

<h2>
<a id="running-the-prep-pipeline-from-eeglab" class="anchor" href="#running-the-prep-pipeline-from-eeglab" aria-hidden="true"><span class="octicon octicon-link"></span></a>Running the PREP pipeline from EEGLAB</h2>

<p>Load an EEG dataset to be processed using the Load dataset submenu under the File menu of EEGLAB.  The PREP pipeline 
can be found under the EEGLAB Tools submenu:<br>
<img src="https://raw.githubusercontent.com/VisLab/EEG-Clean-Tools/gh-pages/images/PrepFromEEGLAB.png" alt="PREP from EEGLAB">  </p>

<p>The PREP main menu shows the processing steps:<br>
<img src="https://raw.githubusercontent.com/VisLab/EEG-Clean-Tools/gh-pages/images/PrepMainMenu.png" alt="PREP main menu for EEGLAB plugin"><br>
Each button allows you to override the default parameters. When you press
the Ok button (or unfortunately the Cancel button), PREP runs.  Use the x button on the upper right to quit without
running the pipeline.   </p>

<p>Normally, PREP won't run on datasets that contain Boundary events. The PREP boundary menu allows you to change how
PREP handles boundary events:<br>
<img src="https://raw.githubusercontent.com/VisLab/EEG-Clean-Tools/gh-pages/images/PrepBoundary.png" alt="PREP boundary menu"><br>
EEGLAB inserts Boundary events to mark discontinuities in the data from epoch rejection or when the data is imported. 
Some, but not all, EEGLAB functions respect discontinuities. PREP expects the data set to be continuous. You should not
override this default setting unless the Boundary events in your data set do not mark discontinuous recording, but 
other features.  </p>

<p>PREP must detrend or high pass filter the data prior detecting line noise or referencing in order to properly
calibrate the thresholds:
<img src="https://raw.githubusercontent.com/VisLab/EEG-Clean-Tools/gh-pages/images/PrepDetrend.png" alt="PREP detrend menu"><br>
By default, PREP uses a high pass filter at 1 Hz for this purpose and does not retain the filtered version of the final
output. This allows you to defer the decision of filtering strategy to downstream processing. Normally, the only default you might need to over ride is what channels to filter. By default, PREP filters all of the channels.  </p>

<p>PREP tries to remove sharp spectral peaks representing line noise at this step:
<img src="https://raw.githubusercontent.com/VisLab/EEG-Clean-Tools/gh-pages/images/PrepLineNoiseParameters.png" alt="PREP line noise menu"><br>
By default, PREP tries to remove multiples of 60 Hz up to the Nyquist frequency (half of the sampling frequency).
You may need to override this if your data set has unusual spectral features. You might also need to specify
which channels should have line noise removed. By default, PREP tries to remove line noise from all channels.  </p>

<p>The PREP settings for the actual reference step are:<br>
<img src="https://raw.githubusercontent.com/VisLab/EEG-Clean-Tools/gh-pages/images/PrepReferenceParameters.png" alt="PREP reference menu"><br>
Normally, the only things you will need to override are the channel specifications. Usually, the reference channels and 
the evaluation channels correspond to brain EEG channels. The re-referenced channels may include additional channels
such as EOG channels and mastoids.  </p>

<p>You can choose to generate a report using the PREP report generation facility:<br>
<img src="https://raw.githubusercontent.com/VisLab/EEG-Clean-Tools/gh-pages/images/PrepReportParameters.png" alt="PREP report menu"><br>
By default, the PREP does not produce a report. If you generate choose to generate a report, you can choose to
publish it in PDF format. Otherwise, PREP displays the report on the command line. You can also choose to
return at a later step and generate the report only.  </p>

<p>After running the PREP pipeline, you can perform additional processing steps:<br>
<img src="https://raw.githubusercontent.com/VisLab/EEG-Clean-Tools/gh-pages/images/PrepPostProcess.png" alt="PREP post process menu">  </p>

<h1>
<a id="prep-overview" class="anchor" href="#prep-overview" aria-hidden="true"><span class="octicon octicon-link"></span></a>PREP Overview</h1>

<p>This section discusses the algorithm and the meeting of the various parameters.</p>

<h3>
<a id="processing-steps" class="anchor" href="#processing-steps" aria-hidden="true"><span class="octicon octicon-link"></span></a>Processing steps</h3>

<ol>
<li>Handle boundary events prior to processing</li>
<li>Remove trend (high pass) temporarily to properly compute thresholds</li>
<li>Remove line noise without committing to a filtering strategy</li>
<li>Robustly reference the signal relative to an estimate of the “true” average reference</li>
<li>Detect and interpolate bad channels relative to this reference</li>
<li>Produce reports if desired</li>
<li>Post process if desired</li>
</ol>

<h2>
<a id="boundary-marker-handling" class="anchor" href="#boundary-marker-handling" aria-hidden="true"><span class="octicon octicon-link"></span></a>Boundary marker handling</h2>

<p>PREP is meant to work on data obtained from a continuous recording session. However, sometimes researchers record multiple sessions in the same file (such as by temporarily suspending and resuming recording). EEGLAB uses boundary events to mark
these discontinuities. Some (but not all) EEGLAB functions respect these boundary markers. By default, the PREP pipeline will not process data sets with boundary markers. Because some researchers use these boundary markers for other purposes than for marking discontinuities, PREP allows the option of temporarily removing boundary markers before processing and then reinserting afterwards. <strong>You should not disregard boundary markers unless you are absolutely sure that these markers</strong>
<strong>to not represent discontinuities.</strong></p>

<h2>
<a id="detrend-high-pass-filtering" class="anchor" href="#detrend-high-pass-filtering" aria-hidden="true"><span class="octicon octicon-link"></span></a>Detrend (high pass filtering)</h2>

<p>High pass filtering of some sort is needed in order for many of the algorithms, including line noise removal and
referencing to perform correctly. However, the exact cutoff may dramatically effect downstream algorithms. By default, 
PREP uses a 1 Hz cutoff, but only temporarily filters, so that the final signal is not high-pass filtered. This
allows you to defer the final choice of high pass cutoff for downstream processing to later. </p>

<h3>
<a id="calling-sequence-for-removing-trends" class="anchor" href="#calling-sequence-for-removing-trends" aria-hidden="true"><span class="octicon octicon-link"></span></a>Calling sequence for removing trends</h3>

<p>The <code>removeTrend</code> function takes two structures in and produces two output structures. The <code>signal</code> structure
includes a <code>.data</code> field and an <code>.srate</code> field. The <code>signal</code> structure is compatible with an EEGLAB EEG structure, but does not rely on any of the other EEGLAB fields. The <code>.data</code> field should be channels x frames. </p>

<p>As with all functions in the pipeline, the algorithm parameters are passed in a structure.  </p>

<blockquote>
<p><code>[signal, detrendOut] = removeTrend(signal, detrendIn)</code><br>
<code>[signal, detrendOut] = removeTrend(signal)</code>  </p>
</blockquote>

<p>The output structure contains all of the input structure fields plus additional fields including a string representation
of the actual command used.</p>

<p><strong>Example:</strong>  </p>

<blockquote>
<p><code>lineNoiseIn = struct('lineNoiseChannels', [1:32, 40:60], 'lineFrequencies', [60, 120, 180, 212, 240]);</code>  </p>
</blockquote>

<h3>
<a id="parameters-for-removing-the-trend" class="anchor" href="#parameters-for-removing-the-trend" aria-hidden="true"><span class="octicon octicon-link"></span></a>Parameters for removing the trend</h3>

<p>The following parameters appear as fields in the <code>detrendIn</code> structure:  </p>

<p><strong><code>detrendChannels</code></strong><br>
 A row vector specifying the channel numbers of the channels to remove the trend from.<br>
By default, PREP uses all of the channels (<code>1:size(signal.data, 1)</code>). 
If your signal has extraneous or unused channels, you should specify which channels to use.  </p>

<p><strong><code>detrendType'</code></strong><br>
The type of detrending operation to perform. At this time the options are 'high pass', 'high pass sinc', 'linear', and
'none'. By default, PREP uses 'high pass' by calling 'pop_eegfiltnew' with the default settings. The
'high pass sinc' setting calls 'pop_firws' with a blackman window type. The 'linear' filter is adapted
from the Chronux toolbox and uses local linear regression. The window size is <code>1.5/detrendCutoff</code>. Generally,
the 'linear' option is much slower than simple high pass filtering and gives very similar results.
Usually you don't have to specify this parameter.  </p>

<p><strong><code>detrendCutoff'</code></strong><br>
The cutoff frequency in Hz for high pass filtering or local detrending. By default, PREP uses 1 Hz. Usually you don't have to specify this parameter.</p>

<p><strong><code>detrendStepSize</code></strong><br>
The amount in seconds to slide the local detrending window when local linear regression is used for detrending. 
By default, PREP uses 0.02 seconds. This parameter is not used unless the <code>detrendType</code> is 'linear'.  </p>

<h2>
<a id="line-noise-removal" class="anchor" href="#line-noise-removal" aria-hidden="true"><span class="octicon octicon-link"></span></a>Line noise removal</h2>

<p>We use an iterative version of the a method that estimates the amplitude and size of a deterministic sinusoid at a specified frequency embedded in locally white noise. The model is applied in sliding windows to adjust for non stationarity. The deterministic frequencies to be removed must be specified to within a small range. By default, the line noise removal (<code>cleanLineNoise</code>) attempts to removal multiples of 60 Hz. You might need to rerun with different frequencies if unusual spectral peaks are visible in the reports. </p>

<h3>
<a id="calling-sequence-for-line-noise-removal" class="anchor" href="#calling-sequence-for-line-noise-removal" aria-hidden="true"><span class="octicon octicon-link"></span></a>Calling sequence for line noise removal</h3>

<p>The <code>cleanLineNoise</code> function takes two structures in and produces two output structures. The signal structure
includes a <code>.data</code> field and an <code>.srate</code> field. The <code>signal</code> structure is compatible with an EEGLAB EEG structure, but does not rely on any of the other EEGLAB fields. The data field should be channels x frames. </p>

<p>As with all functions in the pipeline, the algorithm parameters are passed in a structure.  </p>

<blockquote>
<p><code>[signal, lineNoiseOut] = cleanLineNoise(signal, lineNoiseIn)</code><br>
<code>[signal, lineNoiseOut] = cleanLineNoise(signal)</code>  </p>
</blockquote>

<p>The output structure contains all of the input structure fields plus additional fields containing information on the
tapers used to compute the spectral components and additional fields including a string representation
of the actual command used.</p>

<p><strong>Example:</strong>  </p>

<blockquote>
<p><code>lineNoiseIn = struct('lineNoiseChannels', [1:32, 40:60], 'lineFrequencies', [60, 120, 180, 212, 240]);</code>  </p>
</blockquote>

<h3>
<a id="parameters-for-line-noise-removal" class="anchor" href="#parameters-for-line-noise-removal" aria-hidden="true"><span class="octicon octicon-link"></span></a>Parameters for line noise removal</h3>

<p>The following parameters appear as fields in the <code>lineNoiseIn</code> structure:  </p>

<p><strong><code>lineNoiseChannels</code></strong><br>
 A row vector specifying the channel numbers of the channels to remove line noise from.  By default, PREP uses all of the channels (<code>1:size(signal.data, 1)</code>). If your signal has extraneous or unused channels, you should specify which channels to use.</p>

<p><strong><code>Fs</code></strong><br>
The sampling frequency of the signal in Hz. By default, PREP uses the sampling rate specified in <code>signal.srate</code>. Usually you don't have to specify this parameter.  </p>

<p><strong><code>lineFrequencies</code></strong><br>
A vector of frequencies in Hz of the approximate locations of the line noise peaks to remove. By default, PREP removes multiples of 60 Hz up to the Nyquist frequency (which is half of the sampling frequency). After looking at the spectrum in the report, you may need to redo PREP with additional frequencies. If the data was recorded in a location using a 50 Hz power, you will also need to override.  </p>

<p>The clean line noise procedure used in PREP can only remove sharp peaks with minimal spectral distortion. It does not remove broad peaks. If the PREP reports show that line noise has not been removed to a sufficient extent, you may have to perform additional filtering for a particular application.  </p>

<p><strong><code>p</code></strong><br>
A significance cutoff level for removing a spectral peak. By default, PREP uses a p-value of 0.01. The clean line noise
procedure applies a F-test to determine whether a particular spectral peak is significantly higher than the background level in a small window. You should not have to override this parameter.  </p>

<p><strong><code>fScanBandWidth</code></strong><br>
Half of the width of the frequency band centered on each line frequency. This band is used to search
for the exact value of the maximum amplitude frequency peak near the specified frequencies to be removed. 
By default, PREP uses 2 Hz. You should not have to override this parameter.  </p>

<p><strong><code>taperBandWidth</code></strong><br>
Bandwidth in Hz for the Sleppian tapers used to estimate the spectrum. By default, PREP
uses 2 Hz. You should not have to override this parameter.  </p>

<p><strong><code>taperWindowSize</code></strong><br>
Taper sliding window length in seconds. By default, PREP uses 4 seconds. You should not have to override this parameter.  </p>

<p><strong><code>taperWindowStep</code></strong><br>
Taper sliding window step length in seconds. By default, PREP uses 1 second. You should not have to override this parameter.  </p>

<p><strong><code>tau</code></strong><br>
The window overlap smoothing factor used in the exponent of the signmoidal smoothing functions. This sigmoidal smoothing function is used to patch results from sliding windows back together. By default, PREP uses a value of 100. You should not have to override this parameter.  </p>

<p><strong><code>pad</code></strong><br>
Padding factor for FFTs (-1= no padding, 0 = pad to next power of 2, 1 = pad to power of two after, etc.).
By default, PREP uses a pad factor of 0. A larger positive value gives better spectral results, but requires
much greater computation time. Using a pad value of -1 is not recommended. You should not have to override this parameter.  </p>

<p><strong><code>fPassBand</code></strong><br>
The frequency band (in units of Hz) used to compute the spectral background. By default, PREP
uses <code>[0, Fs/2]</code>. You may need to adjust this range to get better spectral estimates.</p>

<p><strong><code>maximumIterations</code></strong><br>
The maximum number of times that PREP applies the cleaning process to remove line noise. When a particular peak
is not significantly above the background, it is removed from consideration. When no significant peaks remain, PREP
stops the procedure. Most of the time, only a few iterations are required.  You should not have to override this parameter.  </p>

<h2>
<a id="robust-referencing" class="anchor" href="#robust-referencing" aria-hidden="true"><span class="octicon octicon-link"></span></a>Robust referencing</h2>

<p>Referencing is the process of subtracting a common reference signal from all of the channels. Data sets collected
from Biosemi headsets require referencing of some sort. Other headsets benefit as well. When comparing results across
data sets it is important to use the same referencing strategy.  </p>

<p>The PREP pipeline using robust average reference. This process is the same as average referencing (subtracting 
the average of the channels from each channel in each frame) provided the data set does not have any bad
channels.  However, if even if just a single channel has artifacts, the average reference can introduce
errors.  To address this, the robust reference iteratively detects and interpolates bad channels to arrive at an
average reference that is not affected by artifacts.  </p>

<h3>
<a id="calling-sequence-for-referencing" class="anchor" href="#calling-sequence-for-referencing" aria-hidden="true"><span class="octicon octicon-link"></span></a>Calling sequence for referencing</h3>

<p>The <code>performReference</code> function takes two structures in and produces two output structures. The signal structure
includes a <code>.data</code> field and an <code>.srate</code> field. The <code>signal</code> structure is compatible with an EEGLAB EEG structure, but does not rely on any of the other EEGLAB fields. The data field should be channels x frames. </p>

<p>As with all functions in the pipeline, the algorithm parameters are passed in a structure.  </p>

<blockquote>
<p><code>[signal, referenceOut] = performReference(signal, referenceIn)</code><br>
<code>[signal, referenceOut] = performReference(signal)</code>  </p>
</blockquote>

<p>The output structure contains all of the input structure fields plus many additional fields containing the 
reports of the output of the bad channel detection. Details in the document on PREP reporting.</p>

<p><strong>Example:</strong>  </p>

<blockquote>
<p><code>referenceIn = struct('referenceeChannels', [1:32, 40:60]);</code>  </p>
</blockquote>

<h3>
<a id="parameters-for-referencing" class="anchor" href="#parameters-for-referencing" aria-hidden="true"><span class="octicon octicon-link"></span></a>Parameters for referencing</h3>

<p>The following parameters appear as fields in the <code>referenceIn</code> structure:  </p>

<p><strong><code>referenceChannels</code></strong><br>
 A row vector specifying the channel numbers of the channels to use for referencing.  By default, PREP uses all of the channels (<code>1:size(signal.data, 1)</code>). If your signal has extraneous or unused channels, you should specify which channels to use. For standard robust referencing, you should specify only the EEG channels and not EOG channels or mastoids. All of the reference channels will be used to compute the reference. If the channel is bad, PREP uses its interpolated value.  </p>

<p><strong><code>evaluationChannels</code></strong><br>
 A row vector specifying the channel numbers of the channels to use for evaluating noisy channels.  By default, PREP uses all of the channels (<code>1:size(signal.data, 1)</code>). If your signal has extraneous or unused channels, you should specify which channels to use. These channels should only be EEG channels. The channels are used to compute thresholds and to perform
estimates in the RANSAC algorithm. Often the reference channels and the evaluation channels are the same. However, if an EEG channel has NaNs, it will still be used as a reference channel, but will be excluded from evaluation channels.  </p>

<p><strong><code>rereference</code></strong><br>
 A row vector specifying the channel numbers of the channels from which to subtract the computed reference.  By default, PREP uses all of the channels (<code>1:size(signal.data, 1)</code>). If your signal has extraneous or unused channels, you should specify which channels to use. Channels such as mastoids and EOG channels are usually re-referenced but no used to 
compute the robust reference.  </p>

<p><strong><code>referenceType</code></strong><br>
The type of reference to be performed. By default, PREP uses 'robust', which computes an average reference with
iterative detection and interpolation of bad channels.  Other options include 'average', 'specific', and 'none'.
The 'average' type removes the average of the reference channels with no interpolation, while 'specific' removes
the average of the specified channels with no interpolation. If you mean to run the standardized PREP pipeline,
you don't need to specify this field.  </p>

<p><strong><code>interpoationOrder</code></strong><br>
Specifies the when or whether PREP performs final channel interpolation. By default, PREP uses 'post-reference'. 
In this case, after a final robust reference is computed, the channels are re-interpolated and the reference is corrected.
In 'pre-reference', PREP adds to the bad channel list iteratively and interpolates before computing the reference.
If the initial estimate of the reference is poor, this is not a good approach. In the 'none' option, PREP removes the
reference but does not interpolate. If you mean to run the standardized PREP pipeline,
you don't need to specify this field.  </p>

<p><strong><code>meanEstimateType</code></strong><br>
The method used to estimate the initial mean reference. By default, PREP takes the median of the channel values
in each frame. Other options include 'mean', which is prone to outliers,  'huber' which is computationally expensive,
or 'none'. If you mean to run the standardized PREP pipeline,
you don't need to specify this field.  </p>

<p><strong><code>channelLocations</code></strong><br>
A structure containing the channel locations in EEGLAB <code>chanlocs</code> format. By default, PREP uses the <code>signal.chanlocs</code>
structure unless this field is used to over ride. PREP must have channel locations in order to work.  </p>

<p><strong><code>channelInfo</code></strong><br>
A structure containing channel information in EEGLAB <code>chaninfo</code> format. By default, PREP uses the <code>signal.chaninfo</code>
structure unless this field is used to over ride. PREP uses the nose direction for display purposes in the reports.</p>

<p><strong><code>srate</code></strong><br>
The sampling frequency of the signal in Hz. By default, PREP uses the sampling rate specified in <code>signal.srate</code>. Usually you don't have to specify this parameter.  </p>

<p><strong><code>samples</code></strong><br>
The number of frames to use for the computation. By default, PREP uses <code>size(signal.data, 2)</code>. Usually you don't have to specify this parameter.  </p>

<p><strong><code>robustDeviationThreshold</code></strong><br>
Z-score cutoff for robust channel deviation. If a channel has a robust deviation z-score above this value, 
PREP considers the channel to be bad in that window. By default, PREP uses 5. Usually you don't have to specify this parameter.  </p>

<p><strong><code>highFrequencyNoiseThreshold</code></strong><br>
Z-score cutoff for SNR (signal above 50 Hz). If a channel has a z-score of ratio above 50 Hz to below 50 Hz,
PREP considers the channel to be bad in that window. By default, PREP uses 5. Usually you don't have to specify this parameter.  </p>

<p><strong><code>highFrequencyNoiseThreshold</code></strong><br>
Z-score cutoff for SNR (signal above 50 Hz). If a channel has a z-score of ratio above 50 Hz to below 50 Hz,
PREP considers the channel to be bad in that window. By default, PREP uses 5. Usually you don't have to specify this parameter.  </p>

<p><strong><code>correlationWindowSeconds</code></strong><br>
Window size in seconds for computing correlations and other window values. By default, PREP uses 1. 
Usually you don't have to specify this parameter.  </p>

<p><strong><code>correlationWindowSeconds</code></strong><br>
Max correlation absolute threshold for channel being bad in a window. In each window, PREP computes the
maximum of the absolute value of the correlation with other channels and compares to this threshold. If
the correlation falls below this threshold, PREP considers the channel to be bad-by-correlation in this window.
PREP also uses this window size to evaluate windowed absolute deviation and SNR.
By default, PREP uses 0.4. Usually you don't have to specify this parameter.  </p>

<p><strong><code>badTimeThreshold</code></strong><br>
Threshold fraction of bad correlation windows for designating a channel to be bad.
By default, PREP uses 0.01. Usually you don't have to specify this parameter.  </p>

<p><strong><code>ransacOff</code></strong><br>
If true, RANSAC is not used for bad channel detection (useful for small headsets).
By default, PREP uses false. Usually you don't have to specify this parameter.  </p>

<p><strong><code>ransacSampleSize</code></strong><br>
Number of random matrices sampled to estimate RANSAC. By default, PREP uses 50 sample matrices. 
Usually you don't have to specify this parameter.  </p>

<p><strong><code>ransacChannelFraction</code></strong><br>
Fraction of evaluation channels RANSAC uses to predict a channel. By default, PREP uses 0.25 of the
evaluation channels. Usually you don't have to specify this parameter.  </p>

<p><strong><code>ransacCorrelationThreshold</code></strong><br>
Cutoff correlation for unpredictability by neighbors. If the correlation of the channel with
its RANSAC prediction in a window falls below this threshold, the channel is designated as 
bad-by-RANSAC in this window. By default, PREP uses 0.75. Usually you don't have to specify this parameter.  </p>

<p><strong><code>ransacUnbrokenTime</code></strong><br>
Threshold fraction of windows that a channel must be bad-by-RANSAC before it is designated as a
channel that is bad-by-RANSAC. By default, PREP uses 0.4. Usually you don't have to specify this parameter.  </p>

<p><strong><code>ransacCorrelationThreshold</code></strong><br>
Cutoff correlation for unpredictability by neighbors. If the correlation of the channel with
its RANSAC prediction in a window falls below this threshold, the channel is designated as 
bad-by-RANSAC in this window. By default, PREP uses 0.75. Usually you don't have to specify this parameter.  </p>

<p><strong><code>ransacWindowSeconds</code></strong><br>
Size of windows in seconds over which to compute RANSAC predictions. By default, PREP uses 5. Usually you don't have to specify this parameter.  </p>

<p><strong><code>maxReferenceIterations</code></strong><br>
Maximum number of iterations in the reference-bad channel detection-interpolation cycle. 
By default, PREP uses 4. If the actual iterations is 4, you may need to increase this or look carefully at your data set.  </p>

<p><strong><code>reportingLevel</code></strong><br>
How much information to store about referencing in the EEG structure. By default, PREP uses 'verbose', which causes
the data structure to contain all of the window information for later processing and reporting. If you use
'minimum', you will not be able to run the PREP reports.  Alternatively, you can choose to clean up the data structure
after running the reports.  </p>

<h2>
<a id="reporting" class="anchor" href="#reporting" aria-hidden="true"><span class="octicon octicon-link"></span></a>Reporting</h2>

<p>PREP has an extensive report facility that can be used provided that your reporting level was 'verbose'.</p>

<h3>
<a id="calling-sequence-for-reporting" class="anchor" href="#calling-sequence-for-reporting" aria-hidden="true"><span class="octicon octicon-link"></span></a>Calling sequence for reporting</h3>

<p>The <code>publishPrepReport</code> function takes an EEG structure that has been run through the PREP pipeline with
report level of verbose. You need to furnish a summary directory name and a summary file name for an HTML file with summary information for all of the stuff.</p>

<p>As with all functions in the pipeline, the algorithm parameters are passed in a structure.  </p>

<blockquote>
<p><code>publishPrepReport(EEG, summaryFolder, summaryName, sessionFolder, sessionName, consoleFID, publishOn)</code>  </p>
</blockquote>

<p>The output structure contains all of the input structure fields plus additional fields including a string representation
of the actual command used.</p>

<p><strong>Example:</strong>  </p>

<blockquote>
<p><code>lineNoiseIn = struct('lineNoiseChannels', [1:32, 40:60], 'lineFrequencies', [60, 120, 180, 212, 240]);</code>  </p>
</blockquote>

<h3>
<a id="parameters-for-removing-the-trend-1" class="anchor" href="#parameters-for-removing-the-trend-1" aria-hidden="true"><span class="octicon octicon-link"></span></a>Parameters for removing the trend</h3>

<p>The following parameters appear as fields in the <code>detrendIn</code> structure:  </p>

<p><strong><code>detrendChannels</code></strong><br>
 A row vector specifying the channel numbers of the channels to remove the trend from.<br>
By default, PREP uses all of the channels (<code>1:size(signal.data, 1)</code>). 
If your signal has extraneous or unused channels, you should specify which channels to use.  </p>

<pre><code>           'maxReferenceIterations', ...
               getRules(4,  ...
               {'numeric'}, {'positive', 'scalar'}, ...
               'Maximum number of referencing interations'), ...
            'keepFiltered', ...
                getRules(false, {'logical'}, {}, ...
                'If true, final output is filtered rather than unfiltered'), ...
            'reportingLevel', ...
               getRules('verbose',  ...
               {'char'}, {}, ...
               'How much information to store about referencing') ...
               );
</code></pre>

<p>%        case 'reports'
%              [~, EEGbase] = fileparts(signal.filename);
%              defaults = struct( ...
%                 'publishOn', ...
%                    getRules(true, {'logical'}, {}, ...
%                    'If true, use MATLAB publish to publish the results.'), ...
%                'summaryName', ...
%                   getRules([EEGbase 'Summary.html'], {'char'}, {}, ...
%                    'File name for html summary file.'), ...
%                 'summaryFolder', ...
%                   getRules(['.' filesep], {'char'}, {}, ...
%                    'Folder for html summary file.'), ...
%                'reportName', ...
%                   getRules([EEGbase 'Report.pdf'], {'char'}, {}, ...
%                    'File name for html summary file.'), ...
%                'reportFolder', ...
%                   getRules(['.' filesep], {'char'}, {}, ...
%                    'Folder for html summary file.') ...
%                ); </p>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/VisLab/EEG-Clean-Tools">PREP Pipeline: EEG-Clean-Tools</a> is maintained by <a href="https://github.com/VisLab">VisLab</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

            <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-66346771-1");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>

  </body>
</html>
